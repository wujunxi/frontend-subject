google å®˜ç½‘ https://developers.google.com/web/fundamentals/engage-and-retain/app-install-banners/

MSD Service Workerè¯´æ˜ https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers

w3c å…³äº ServiceWorkerçš„è§£é‡Š https://github.com/w3c/ServiceWorker/blob/master/explainer.md

w3c SWå®ç°è¯´æ˜ https://w3c.github.io/ServiceWorke

ç¼“å­˜æ–¹å¼
https://jakearchibald.com/2014/offline-cookbook/

æµè§ˆå™¨æ–°ç‰¹æ–°æ£€æµ‹ï¼ï¼ï¼https://whatwebcando.today
è…¾è®¯X5 ç‰¹æ€§æ£€æµ‹ https://x5.tencent.com/tbs/guide/h5_support/index.htm

1. ç›®å‰IOSä¸æ”¯æŒ
2. å›½äº§æ‰‹æœºè‡ªå®šä¹‰ROMæ²¡æœ‰æŒ‰æ ‡å‡†å®ç°ï¼Œä¸èƒ½æ·»åŠ åˆ°ä¸»å±ã€ç‹¬ç«‹è¿è¡Œ
3. Service Worker æµè§ˆå™¨å…¼å®¹é—®é¢˜
4. æ— æ³•ä½¿ç”¨Googleçš„GCMæ¨é€
5. é™çº§æ–¹æ¡ˆ
if (navigator.serviceWorker)
navigator.serviceWorker.register(â€¦)

============================== Service Work ==============================
åº”ç”¨åœºæ™¯
ï¼ˆ1ï¼‰ç¼“å­˜ã€‚æ€§èƒ½å¢å¼ºï¼Œæ¯”å¦‚é¢„å–å¹¶ç¼“å­˜ç”¨æˆ·å¯èƒ½éœ€è¦çš„èµ„æºï¼Œæ¯”å¦‚é¡µé¢ä¸­æ‰€éœ€çš„é™æ€èµ„æºæ–‡ä»¶
ï¼ˆ2ï¼‰åå°æ•°æ®åŒæ­¥
ï¼ˆ3ï¼‰åå°æœåŠ¡é’©å­
ï¼ˆ4ï¼‰å“åº”æ¥è‡ªå…¶å®ƒæºçš„èµ„æºè¯·æ±‚
ï¼ˆ5ï¼‰è‡ªå®šä¹‰æ¨¡æ¿ç”¨äºç‰¹å®šURLæ¨¡å¼
ï¼ˆ6ï¼‰é›†ä¸­æ¥æ”¶è®¡ç®—æˆæœ¬é«˜çš„æ•°æ®æ›´æ–°
ï¼ˆ7ï¼‰åœ¨å®¢æˆ·ç«¯è¿›è¡Œæ¨¡å—ç¼–è¯‘å’Œä¾èµ–ç®¡ç†

è…¾è®¯QQé’±åŒ… SONICä¼˜åŒ–æ–¹æ¡ˆ
ï¼ˆ1ï¼‰é¡µé¢ç¼“å­˜ï¼šsonicæ”¯æŒå¯¹h5é¡µé¢çº§è¿›è¡Œæœ¬åœ°ç¼“å­˜ï¼Œå°†è¿”å›çš„é¡µé¢åˆ†åˆ«æ‹†åˆ†æˆæ•°æ®å±‚ä»¥åŠæ¨¡ç‰ˆå±‚å±‚åˆ†å¼€æ¥ç¼“å­˜ï¼Œç”Ÿæˆæœ¬åœ°ç¼“å­˜æ–‡ä»¶ï¼Œä¸”ç¼“å­˜æ—¶é•¿ä¸ºæ°¸ä¹…ç¼“å­˜ï¼Œå¦‚æœé¡µé¢æ˜¯æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œè¿™æ—¶å€™ä¼šå®Œå…¨æ˜¾ç¤ºç¼“å­˜çš„æ•°æ®
ï¼ˆ2ï¼‰å¢é‡æ›´æ–°ï¼šå¯¹äºé¡µé¢æ›´æ–°çš„æƒ…å†µï¼Œsonicä¼šå»å¯¹æ¯”å’Œè®¡ç®—å®¢æˆ·ç«¯ç¼“å­˜ä¸­çš„é¡µé¢çš„å˜æ›´åœ°æ–¹ï¼Œå°è£…æˆjsonæ•°æ®ç»“æ„è¿”å›ç»™å®¢æˆ·ç«¯è¿›è¡Œé¡µé¢æ›´æ–°ä»¥åŠç¼“å­˜æ›´æ–°ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°äº†å›åŒ…çš„å¤§å°ï¼Œç‰¹åˆ«å¯¹äºç§»åŠ¨ç½‘ç»œè€Œè¨€å¯ä»¥å¤§å¹…åº¦ä¸ºç”¨æˆ·èŠ‚çœäº†è¯·æ±‚æµé‡
é‡ç‚¹ï¼šåŠ¨é™åˆ†ç¦»ã€èµ„æºç¼“å­˜ã€ä¸²è¡Œ/å¹¶è¡Œã€å¢é‡æ›´æ–°

fetch(â€˜ç°åº¦/é™çº§å¼€å…³â€™)
.then(() => {
é™çº§ ? å…¨éƒ¨æ³¨é”€ : æ³¨å†Œ
})

åˆ«å¿˜äº†æ³¨é”€

åˆ«æŠŠå¼€å…³æ¥å£ç¼“å­˜äº†

6. ç›‘æ§ç³»ç»Ÿ

self.addEventListener(â€˜errorâ€™, â€¦)
event.message
event.filename
event.lineno
event.colno
event.error.stack

self.addEventListener('unhandledrejection', â€¦)
event.reason

è¦åœ¨åˆå§‹åŒ–æ—¶æ³¨å†Œ



7. æ•°æ®ç»Ÿè®¡

è®¿é—®é‡ã€å•é‡ã€è½¬åŒ–ç‡â€¦â€¦


8. ç´§æ€¥æŠ¢æ•‘
åœ¨ SW é‡Œæ³¨é”€è‡ªå·±
self.registration.unregister()
â€¢ åœ¨ HTML é‡Œå¼ºè¡Œæ³¨é”€ SW
ğŸ™navigator.serviceWorker.getRegistrations
ğŸ™‚navigator.serviceWorker.getRegistration
â€¢ æ¸…ç©º sw.js

SW åº“
https://googlechrome.github.io/sw-toolbox/
https://github.com/googlechrome/sw-precache
https://github.com/goldhand/sw-precache-webpack-plugin

ä½¿ç”¨ lighthouse å®¡æŸ¥ç½‘ç»œåº”ç”¨ https://developers.google.com/web/tools/lighthouse/

9.PWAéªŒè¯ https://developers.google.com/web/progressive-web-apps/checklist

10. Bug
â€¢ User Agent åœ¨ worker çº¿ç¨‹ä¸­ä¸ï¥§æ­£ç¡®
â€¢ HTTP Header å¯¼è‡´è·¨åŸŸè¯·æ±‚å¤±è´¥
â€¢ UC 301 è·³è½¬é—®é¢˜

=====================================================================

Updating a service worker

The lifecycle of a service worker is based on Chromeâ€™s update model: do as much as possible in the background, donâ€™t disrupt the user, complete the update when the current version closes.

Whenever you navigate to a page within scope of your service worker, the browser checks for updates in the background. If the script is byte-different, itâ€™s considered to be a new version, and installed (note: only the script is checked, not external importScripts). However, the old version remains in control over pages until all tabs using it are gone (unless .replace() is called during install). Then the old version is garbage collected and the new version takes over.


service workerçš„ç”Ÿå‘½å‘¨æœŸæ˜¯åŸºäºChromeçš„æ›´æ–°æ¨¡å‹ï¼šå°½é‡å†åå°å¤„ç†ä¸å»æ‰“æ‰°ç”¨æˆ·ï¼Œå½“å½“å‰ç‰ˆæœ¬ç¤ºä¾‹å…³é—­æ—¶å†è¿›è¡Œæ›´æ–°ã€‚

å½“ä½ æµè§ˆä»»æ„ä¸€ä¸ªå—service workeræ§åˆ¶çš„é¡µé¢ï¼Œæµè§ˆå™¨å°±ä¼šåœ¨åå°è‡ªåŠ¨æ£€æŸ¥è¯¥service workerçš„æ›´æ–°ã€‚åªè¦è„šæœ¬æœ‰ä¸€æ¯”ç‰¹çš„æ›´æ–°ï¼Œå°±ä¼šè®¤ä¸ºæœ‰ä¸€ä¸ªæ–°ç‰ˆæœ¬å¹¶å¯åŠ¨å®‰è£…ã€‚ï¼ˆæ³¨æ„ï¼šåªæœ‰service workerçš„è„šæœ¬ä¼šè¢«æ£€æŸ¥ï¼Œé€šè¿‡importScriptså¯¼å…¥çš„è„šæœ¬åˆ™ä¸ä¼šï¼‰ã€‚ä½†æ˜¯æ­¤æ—¶è€çš„ç‰ˆæœ¬ä»ç„¶è¿è¡Œï¼Œç›´åˆ°æ‰€æœ‰æ ‡ç­¾é¡µä¸­å—service workeræ§åˆ¶çš„é¡µé¢éƒ½å·²å…³é—­ï¼Œè€çš„ç‰ˆæœ¬æ‰ä¼šè¢«åƒåœ¾å›æ”¶ï¼ˆ
GCï¼‰ï¼Œæ–°ç‰ˆæœ¬ç”Ÿæ•ˆã€‚

=====================================================================

